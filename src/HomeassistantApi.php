<?php

namespace Mapo89\LaravelHomeassistantApi;

use Illuminate\Support\Str;
use Mapo89\LaravelHomeassistantApi\Api\Utils\ApiClient;

class HomeassistantApi
{
    protected ApiClient $client;

    public function __construct(?ApiClient $client = null)
    {
        $this->client = $client ?? new ApiClient();
    }

    public static function make(?array $config = null): self
    {
        return new self(
            new ApiClient($config)
        );
    }

    public function __call(string $method, array $parameters): object
    {
        return $this->getApiInstance($method);
    }

    protected function getApiInstance(string $method): object
    {
        $class = __NAMESPACE__ . '\\Api\\' . Str::studly($method);

        if (!class_exists($class)) {
            throw new \BadMethodCallException(
                sprintf(
                    'API endpoint [%s] does not exist. Expected class %s.',
                    $method,
                    $class
                )
            );
        }

        return new $class($this->client);
    }
}
